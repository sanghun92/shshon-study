# Optimistic and pessimistic record locking

- 데이터베이스에서 동시성을 제어하는 방법은 크게 2가지이다.
- 낙관적 락과 비관적 락이라는 2가지의 주요 락킹 메커니즘이 있음.
- 각각의 방식은 동시성 제어에 있어 서로 다른 접근 방식을 제공함.

---

## Optimistic locking :

- 데이터를 읽을때는 락을 걸지않고, 데이터를 업데이트할때만 이전 데이터와 현재 데이터를 비교하여 충돌 여부를 판단함.
- 이러한 방식은 데이터베이스의 성능 저하를 최소화하고, 동시성을 높이는데 유리함.

| 제목    | 내용                                                                                        |
|-------|-------------------------------------------------------------------------------------------|
| 장점    | 성능이 좋고, 데드락 발생 가능성이 낮음. 왜냐하면 데이터를 읽는 동안 다른 트랜잭션이 해당 데이터를 변경할 수 있기 때문임.                    |
| 단점    | 충돌이 발생했을때 데이터를 다시 읽어서, 업데이트하는 추가 작업이 필요함. 왜냐하면 충돌을 해결하기위해 충돌 발생 시점부터 트랜잭션을 다시 시작해야하기 떄문임. |
| 적용 사례 | 웹 애플리케이션에서 사용자의 요청을 처리할때 주로 사용함. 이런 환경은 동시에 같은 데이터를 변경할려는 경우가 드물기 떄문.                     |
| 구현 방법 | 버전 번호를 사용하는 것임. 데이터가 업데이트될때마다 버전 번호를 증가시키고, 업데이트 시점에 버전 번호를 검사하여 충돌을 감지함.                 |

---

## Pessimistic locking :

- 데이터를 읽을때부터 해당 데이터에 락을 걸어서 다른 트랜잭션이 해당 데이터를 변경하지 못하게 함.
- 이러한 방식은 데이터의 일관성을 유지하는데 초첨을 맞춤.

| 제목    | 내용                                                                       |
|-------|--------------------------------------------------------------------------|
| 장점    | 데이터의 일관성을 보장할 수 있음. 왜냐하면 데이터를 읽는 동안 다른 트랜잭션이 해당 데이터를 변경할 수 없기 때문.        |
| 단점    | 성능 저하와 데드락 발생 가능성이 높음. 데이터에 락을 걸어두면, 다른 트랜잭션이 해당 데이터에 접근할 수 없기 떄문.       |
| 적용 사례 | 금융 시스템에서 자주 사용됨.                                                         |
| 구현 방법 | 데이터베이스의 락 기능을 사용하는것임. 데이터를 읽을때 SELECT FOR UPDATE와 같은 쿼리를 사용하여 데이터에 락을 검. |

---

## 결론

- 2가지 락킹 메커니즘은 주어진 요구 사항과 환경에 따라 적절히 선택할 수 있어야함.
- 낙관적 락은 성능이 중요하고 충돌 가능성이 낮은 환경에서 유리함.
- 비관적 락은 데이터의 일관성이 중요하고 충돌 가능성이 높은 환경에서 유리함.
